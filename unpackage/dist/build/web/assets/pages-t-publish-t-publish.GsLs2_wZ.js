import{l as e,r as l,m as a,p as t,q as s,h as u,a as o,w as n,c,j as i,F as r,i as d,S as p,o as v,b as m,t as f,u as h,v as g,d as _,k as y,x,s as w,y as k,z as C,A as b,B as S,n as j,f as D,I as V,C as F,P as L,D as P}from"./index-BQqAIaJa.js";import{g as E,f as T,h as N,i as q}from"./index.BtZ1W5nT.js";import{_ as A,a as I}from"./_plugin-vue_export-helper.VBtj53E2.js";import{u as U}from"./useMainStore.fUJgjUay.js";const z="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20fill='none'%20version='1.1'%20width='6'%20height='6'%20viewBox='0%200%206%206'%3e%3cg%3e%3cpath%20d='M1.93194,6L0.675393,5.04132L2.08901,3.35537L0,2.89256L0.486911,1.33884L2.43456,2.24793L2.21466,0L3.78534,0L3.54974,2.24793L5.51309,1.33884L6,2.89256L3.89529,3.35537L5.32461,5.04132L4.08377,6L3,4.03306L1.93194,6Z'%20fill='%23FC0402'%20fill-opacity='1'/%3e%3c/g%3e%3c/svg%3e",B="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20fill='none'%20version='1.1'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%3e%3cdefs%3e%3cclipPath%20id='master_svg0_17_29107'%3e%3crect%20x='0'%20y='0'%20width='24'%20height='24'%20rx='0'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20clip-path='url(%23master_svg0_17_29107)'%3e%3cg%20transform='matrix(0.7071067690849304,-0.7071067690849304,0.7071067690849304,0.7071067690849304,-8.485292692961764,3.514723519501615)'%3e%3cg%3e%3crect%20x='0'%20y='19.54274082183838'%20width='16.970455169677734'%20height='1.8856195211410522'%20rx='0.9428097605705261'%20fill='%23D8D8D8'%20fill-opacity='1'/%3e%3c/g%3e%3cg%20transform='matrix(0,1,-1,0,21.42775058746338,2.572281837463379)'%3e%3crect%20x='9.427734375'%20y='12.000016212463379'%20width='16.9705753326416'%20height='1.885606050491333'%20rx='0.9428030252456665'%20fill='%23D8D8D8'%20fill-opacity='1'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",R=A({__name:"t-publish",setup(A){const R=U();e();let M=l("");const Z=l(""),G=l(!0),O=l(""),$=l(""),H=l(""),J=l("");let K=l(!0),Q=l([]),W=l([]),X=l(0);const Y=l(!1),ee=l(!1),le=l(!1),ae=l("height: 50px; color: #007aff;"),te=l("请选择");l(1);const se=l(0),ue=l(""),oe=l(null);function ne(){Y.value=!1,ee.value=!1,le.value=!1,ie.value=!1}const ce=a((()=>"请选择"===te.value)),ie=l(!1),re=l([0]),de=l([]);for(let e=1;e<100;e++)de.value.push(e);const pe=l(null),ve=l(null);function me(){Q.value=[]}async function fe(){x({title:"提示",content:"确定要下载模板吗？",showCancel:!0,success:async e=>{if(e.confirm)try{const e=await E("student");if(50===e.code)w({title:"下载失败",icon:"none",duration:1500});else{const l=await async function(e){return new Promise(((l,a)=>{k({url:e,success:e=>{200===e.statusCode?l(e.tempFilePath):(w({title:"文件下载失败",icon:"none"}),a())},fail:()=>{w({title:"文件下载失败",icon:"none"}),a()}})}))}(e.data);l&&w({title:"下载成功",icon:"success",duration:1500})}}catch(l){console.error("Error fetching user data:",l),w({title:"下载失败，请检查网络或联系管理员",icon:"none",duration:1500})}else w({title:"已取消下载",icon:"none",duration:1500})}})}async function he(){try{const{tempFilePaths:e,tempFiles:l}=await C({count:1,type:"file",extension:["xls","xlsx"]});if(0===e.length)return void w({title:"请选择文件",icon:"none"});const a=l[0];b({url:"/baseurl/openuse/getintentionstudents",filePath:a.path,name:"studentfile",formData:{},header:{"Content-Type":"multipart/form-data",Authorization:S("v_token")},success:e=>{if(console.log("File uploaded successfully:",e),0==e.data.code){let e=res.data.data.Studentinfo;Array.isArray(e)?e.forEach(((e,l)=>{W.value.push({name:e.name,num:e.sno,pros:e.majorName,ban:e.class,phone:e.phone})})):W.value.push({name:e.name,num:e.sno,pros:e.majorName,ban:e.class,phone:e.phone}),w({title:"文件导入成功",icon:"success"})}else w({title:"文件导入失败",icon:"none"})},fail:e=>{console.error("Error uploading file:",e),w({title:"文件导入失败",icon:"none"})}}).onProgressUpdate((e=>{console.log("上传进度："+e.progress)}))}catch(e){console.error("Error selecting or uploading file:",e),w({title:"操作失败",icon:"none"})}}function ge(e){re.value=e.detail.value,pe.value=de.value[e.detail.value[0]],console.log(pe.value)}function _e(){ie.value=!0}function ye(){te.value=pe.value,ne()}function xe(){!async function(){let e=K.value?0:1,l=[];Q.value.forEach(((e,a)=>{l.push(e.num)}));let a={projectPracticeName:M.value,projectPracticeCode:R.proId,title:Z.value,content:O.value,guidance_place:$.value,guidance_time:H.value,resultDisplay:J.value,studentRequirements:te.value,releaseStatus:1,budgetSrouce:e,majorToGrade:{},budget:se.value,appointStudent:l,code:oe.value},t=await N(a);console.log(t,"aaahhhhhhh"),ne(),"success"==t.data.message?(w({title:"题目已发布!",icon:"success",duration:1e3}),setTimeout((()=>{j({url:"/pages/t-index/t-index"})}),1e3)):w({title:"题目发布失败!",icon:"error",duration:1e3})}()}function we(){le.value=!0}t((()=>{}));const ke={title:Z,content:O,place:$,time:H,stunum:te,resultdisplay:J};async function Ce(){let e=K.value?0:1,l=[];Q.value.forEach(((e,a)=>{l.push(e.num)}));let a={projectPracticeName:M.value,projectPracticeCode:R.proId,title:Z.value,content:O.value,guidance_place:$.value,guidance_time:H.value,resultDisplay:J.value,studentRequirements:te.value,releaseStatus:0,budgetSrouce:e,majorToGrade:{},budget:se.value,appointStudent:l,code:oe.value},t=await N(a);console.log(t,"zan"),"success"==t.data.message?(w({title:"题目已暂存!",icon:"success",duration:1e3}),setTimeout((()=>{j({url:"/pages/t-index/t-index"})}),1e3)):w({title:"题目暂存失败",icon:"error",duration:1e3})}return I((()=>{console.log(R.profession,R.proId,R.shareCopy,R.changeData,"ssss"),M.value=R.profession;let e,l,a,t,s=null;null!=R.shareCopy&&(e=R.shareCopy,l=R.shareCopy.Course,a=R.shareCopy.StudentLists),null!=R.changeData&&(console.log(R.changeData,"kkks"),G.value=!1,t=R.changeData.Course,s=R.changeData.StudentLists),null!=t?(oe.value=t.code,Z.value=t.title,O.value=t.content,$.value=t.guidancePlace,H.value=t.guidanceTime,J.value=t.resultDisplay,te.value=t.studentRequirements,K.value=0==t.budgetSrouce,se.value=t.budget,R.setChangeData(null)):null!=l?(oe.value=l.code,Z.value=l.title,O.value=l.content,$.value=l.guidancePlace,H.value=l.guidanceTime,J.value=l.resultDisplay,te.value=l.studentRequirements,K.value=0==l.budgetSrouce,se.value=l.budget,R.setCopyData(null)):null!=e&&(oe.value=e.code,Z.value=e.title,O.value=e.content,$.value=e.guidancePlace,H.value=e.guidanceTime,J.value=e.resultDisplay,te.value=e.studentRequirements,K.value=0==e.budgetSrouce,se.value=e.budget,R.setCopyData(null)),null!=a&&a.forEach(((e,l)=>{Q.value.push({name:e.name,num:e.sno,pros:e.majorName,ban:e.class,phone:e.phone})})),null!=s&&s.forEach(((e,l)=>{Q.value.push({name:e.name,num:e.sno,pros:e.majorName,ban:e.class,phone:e.phone})}))})),(e,l)=>{const a=d,t=D,x=V,k=F,C=p,b=L,S=P,E=s("uni-popup");return v(),u(r,null,[o(C,{class:"containers","scroll-y":"true"},{default:n((()=>[o(a,{class:"headers"},{default:n((()=>[m(f(h(M)),1)])),_:1}),o(a,{style:{width:"90vw","margin-left":"5vw"}},{default:n((()=>[o(a,{class:"theme"},{default:n((()=>[o(t,{src:z,mode:""}),m(" 1. 题目 ")])),_:1}),o(a,{class:"inputs"},{default:n((()=>[o(x,{type:"text",placeholder:"请输入","placeholder-class":"placeholderStyle",modelValue:Z.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Z.value=e)},null,8,["modelValue"])])),_:1}),o(a,{class:"theme"},{default:n((()=>[o(t,{src:z,mode:""}),m(" 2. 项目内容 ")])),_:1}),o(a,{class:"inputss"},{default:n((()=>[o(k,{class:"textarea",maxlength:"200",placeholder:"请输入(200字以内)","placeholder-class":"placeholderStyle",modelValue:O.value,"onUpdate:modelValue":l[1]||(l[1]=e=>O.value=e)},null,8,["modelValue"])])),_:1}),o(a,{class:"theme"},{default:n((()=>[o(t,{src:z,mode:""}),m(" 3. 教师指导内容及方式 ")])),_:1}),o(a,{class:"inputs"},{default:n((()=>[o(x,{type:"text",placeholder:"指导地点","placeholder-class":"placeholderStyle",modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=e=>$.value=e)},null,8,["modelValue"])])),_:1}),o(a,{class:"inputs"},{default:n((()=>[o(x,{type:"text",placeholder:"指导时间","placeholder-class":"placeholderStyle",modelValue:H.value,"onUpdate:modelValue":l[3]||(l[3]=e=>H.value=e)},null,8,["modelValue"])])),_:1}),o(a,{class:"theme"},{default:n((()=>[o(t,{src:z,mode:""}),m(" 4. 最终成果展现要求 ")])),_:1}),o(a,{class:"inputss"},{default:n((()=>[o(k,{class:"textarea",modelValue:J.value,"onUpdate:modelValue":l[4]||(l[4]=e=>J.value=e),maxlength:"200",placeholder:"请输入(200字以内)","placeholder-class":"placeholderStyle"},null,8,["modelValue"])])),_:1}),o(a,{class:"theme"},{default:n((()=>[o(t,{src:z,mode:""}),m(" 5. 学生人数要求 ")])),_:1}),o(a,{class:g(["inputs",{placeholderStyle:ce.value}]),onClick:_e},{default:n((()=>[m(f(te.value),1)])),_:1},8,["class"]),o(a,{class:"theme"},{default:n((()=>[o(t,{src:z,mode:""}),m(" 6.项目费用预算 ")])),_:1}),o(a,{class:"xuan",onClick:l[5]||(l[5]=e=>_(K)?K.value=!0:K=!0)},{default:n((()=>[o(t,{src:h(K)?"/static/7.svg":"/static/77.svg",mode:""},null,8,["src"]),m(" 利用现有资源，不用经费 ")])),_:1}),o(a,{class:"xuan",onClick:l[6]||(l[6]=e=>_(K)?K.value=!1:K=!1)},{default:n((()=>[o(t,{src:h(K)?"/static/77.svg":"/static/7.svg",mode:""},null,8,["src"]),m(" 申请学院教学实验经费 ")])),_:1}),h(K)?i("",!0):(v(),c(a,{key:0,class:"inputs"},{default:n((()=>[o(x,{type:"text",placeholder:"请填写经费预算金额","placeholder-class":"placeholderStyle",modelValue:se.value,"onUpdate:modelValue":l[7]||(l[7]=e=>se.value=e)},null,8,["modelValue"])])),_:1})),o(a,{class:"theme",style:{display:"flex","margin-bottom":"20px"}},{default:n((()=>[m(" 7. 指定意向学生 "),o(a,{class:"zzz"},{default:n((()=>[m("(选填)")])),_:1}),o(a,{class:"pi",onClick:me,style:{color:"#999CA2",position:"absolute",right:"36vw"}},{default:n((()=>[m("批量删除")])),_:1}),o(a,{class:"pi",onClick:he,style:{color:"#5279F2",position:"absolute",right:"20vw"}},{default:n((()=>[m("批量导入")])),_:1}),o(a,{class:"pi",onClick:fe,style:{color:"#5279F2",position:"absolute",right:"5vw"}},{default:n((()=>[m("下载模板")])),_:1})])),_:1}),(v(!0),u(r,null,y(h(Q),((e,l)=>(v(),c(a,{class:"stus",key:l},{default:n((()=>[o(a,null,{default:n((()=>[o(a,{class:"name"},{default:n((()=>[m(f(e.name),1)])),_:2},1024),o(a,{class:"msg"},{default:n((()=>[m("学号："+f(e.num),1)])),_:2},1024),o(a,{class:"msg"},{default:n((()=>[m("专业："+f(e.pros),1)])),_:2},1024),o(a,{class:"msg"},{default:n((()=>[m("班级："+f(e.ban),1)])),_:2},1024),o(a,{class:"msg"},{default:n((()=>[m("电话："+f(e.phone),1)])),_:2},1024)])),_:2},1024),o(a,null,{default:n((()=>[o(a,{class:"edit",onClick:e=>(ee.value=!0,_(X)?X.value=l:X=l)},{default:n((()=>[m("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128)),o(a,{class:"addstu",onClick:we},{default:n((()=>[o(t,{src:"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20fill='none'%20version='1.1'%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%3e%3cg%3e%3cg%3e%3cellipse%20cx='8'%20cy='8'%20rx='8'%20ry='8'%20fill='%232277F8'%20fill-opacity='1'/%3e%3c/g%3e%3cg%3e%3crect%20x='4'%20y='7'%20width='8'%20height='2'%20rx='1'%20fill='%23FFFFFF'%20fill-opacity='1'/%3e%3c/g%3e%3cg%20transform='matrix(0,1,-1,0,13,-5)'%3e%3crect%20x='9'%20y='4'%20width='8'%20height='2'%20rx='1'%20fill='%23FFFFFF'%20fill-opacity='1'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",mode:""}),m(" 添加学生 ")])),_:1}),G.value?(v(),c(a,{key:1,style:{display:"flex","justify-content":"space-around","margin-top":"55px"}},{default:n((()=>[o(a,{class:"chun",onClick:Ce},{default:n((()=>[m(" 暂存 ")])),_:1}),o(a,{class:"pub",onClick:l[8]||(l[8]=e=>function(){let e=!0;for(let a of Object.keys(ke)){const t=ke[a];l=t.value,console.log(l),(""==l||null==l)&&(console.warn(`${t} is empty`),e=!1)}var l;e?Y.value=!0:w({title:"请填写完整信息!",icon:"error",duration:1e3})}())},{default:n((()=>[m(" 发布 ")])),_:1})])),_:1})):(v(),c(a,{key:2,style:{display:"flex","justify-content":"space-around","margin-top":"55px"}},{default:n((()=>[o(a,{class:"pub",style:{width:"80%"},onClick:l[9]||(l[9]=e=>async function(){let e=K.value?0:1,l=[];Q.value.forEach(((e,a)=>{l.push(e.num)}));let a={projectPracticeName:M.value,projectPracticeCode:R.proId,title:Z.value,teacher_name:localStorage.getItem("v_name"),teacher_sno:localStorage.getItem("v_number"),content:O.value,guidance_place:$.value,guidance_time:H.value,resultDisplay:J.value,studentRequirements:te.value,releaseStatus:1,budgetSrouce:e,majorToGrade:{},budget:se.value,appointStudent:l,code:oe.value},t=await T(a);console.log(t,"ffffssssss",a),ne(),"success"==t.data.message?(w({title:"题目已修改!",icon:"success",duration:1e3}),setTimeout((()=>{j({url:"/pages/t-index/t-index"})}),1e3)):w({title:"题目修改失败!",icon:"error",duration:1e3})}())},{default:n((()=>[m(" 修改 ")])),_:1})])),_:1}))])),_:1})])),_:1}),Y.value?(v(),c(a,{key:0,class:"mask"},{default:n((()=>[o(a,{class:"modal"},{default:n((()=>[o(a,{class:"dels",onClick:l[10]||(l[10]=e=>xe())},{default:n((()=>[m(" 确认发布 ")])),_:1}),o(a,{class:"footer",onClick:ne},{default:n((()=>[m(" 取消 ")])),_:1})])),_:1})])),_:1})):i("",!0),ee.value?(v(),c(a,{key:1,class:"mask"},{default:n((()=>[o(a,{class:"modal"},{default:n((()=>[o(a,{class:"dels",onClick:l[11]||(l[11]=e=>(console.log(X.value),X.value>=0&&X.value<Q.value.length&&Q.value.splice(X.value,1),void ne()))},{default:n((()=>[m(" 确认删除 ")])),_:1}),o(a,{class:"footer",onClick:ne},{default:n((()=>[m(" 取消 ")])),_:1})])),_:1})])),_:1})):i("",!0),ie.value?(v(),c(a,{key:2,class:"mask"})):i("",!0),ie.value?(v(),c(E,{key:3,ref_key:"pickerView",ref:ve,style:{width:"100vw",position:"fixed",bottom:"0"}},{default:n((()=>[o(a,{class:"popup-view"},{default:n((()=>[o(a,{class:"popup-view-header"},{default:n((()=>[m(" 选择可选课学生人数 "),o(t,{onClick:ne,src:B,mode:""})])),_:1}),o(S,{"indicator-style":ae.value,value:re.value,onChange:ge,class:"picker-view"},{default:n((()=>[o(b,null,{default:n((()=>[(v(!0),u(r,null,y(de.value,((e,l)=>(v(),c(a,{class:"item",key:l},{default:n((()=>[m(f(e),1)])),_:2},1024)))),128))])),_:1})])),_:1},8,["indicator-style","value"]),o(a,{class:"qur",onClick:ye},{default:n((()=>[m("确认")])),_:1})])),_:1})])),_:1},512)):i("",!0),le.value?(v(),c(a,{key:4,class:"mask"})):i("",!0),le.value?(v(),c(E,{key:5,ref_key:"pickerView",ref:ve,style:{width:"100vw",position:"fixed",bottom:"0"}},{default:n((()=>[o(a,{class:"popup-views"},{default:n((()=>[o(a,{class:"popup-view-header"},{default:n((()=>[m(" 选择学生 "),o(t,{onClick:ne,src:B,mode:""})])),_:1}),o(a,{class:"search"},{default:n((()=>[o(t,{src:"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20fill='none'%20version='1.1'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%3e%3cdefs%3e%3cclipPath%20id='master_svg0_17_06661/17_06363'%3e%3crect%20x='0'%20y='0'%20width='24'%20height='24'%20rx='0'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20clip-path='url(%23master_svg0_17_06661/17_06363)'%3e%3cg%3e%3cpath%20d='M11.11995849609375,20.72001953125C5.83995849609375,20.72001953125,1.51995849609375,16.400019531250003,1.51995849609375,11.12001953125C1.51995849609375,5.84001953125,5.83995849609375,1.52001953125,11.11995849609375,1.52001953125C16.399958496093753,1.52001953125,20.71995849609375,5.84001953125,20.71995849609375,11.12001953125C20.71995849609375,16.400019531250003,16.399958496093753,20.72001953125,11.11995849609375,20.72001953125ZM11.11995849609375,19.12001953125C15.51995849609375,19.12001953125,19.11995849609375,15.52001953125,19.11995849609375,11.12001953125C19.11995849609375,6.72001953125,15.51995849609375,3.12001953125,11.11995849609375,3.12001953125C6.71995849609375,3.12001953125,3.11995849609375,6.72001953125,3.11995849609375,11.12001953125C3.11995849609375,15.52001953125,6.71995849609375,19.12001953125,11.11995849609375,19.12001953125ZM17.03995849609375,20.40001953125C16.71995849609375,20.08001953125,16.79995849609375,19.52001953125,17.11995849609375,19.28001953125C17.43995849609375,19.04001953125,17.99995849609375,19.04001953125,18.23995849609375,19.36001953125L19.75995849609375,21.20001953125C20.07995849609375,21.52001953125,19.99995849609375,22.08001953125,19.67995849609375,22.32001953125C19.35995849609375,22.56001953125,18.79995849609375,22.56001953125,18.55995849609375,22.24001953125L17.03995849609375,20.40001953125Z'%20fill='%239A9B9D'%20fill-opacity='1'%20style='mix-blend-mode:passthrough'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",mode:""}),o(x,{type:"text",placeholder:"输入学生姓名/学号搜索",modelValue:ue.value,"onUpdate:modelValue":l[12]||(l[12]=e=>ue.value=e)},null,8,["modelValue"]),o(a,{class:"sss",onClick:l[13]||(l[13]=e=>async function(){let e=await q(ue.value);if(W.value=[],console.log(e,ue.value),"failed"==e.data.message)w({title:"搜索失败",icon:"error",duration:1e3});else{let l=e.data.Studentinfo;Array.isArray(l)?l.forEach(((e,l)=>{W.value.push({name:e.name,num:e.sno,pros:e.majorName,ban:e.class,phone:e.phone})})):W.value.push({name:l.name,num:l.sno,pros:l.majorName,ban:l.class,phone:l.phone})}}())},{default:n((()=>[m("搜索")])),_:1})])),_:1}),(v(!0),u(r,null,y(h(W),((e,l)=>(v(),c(a,{class:"stus",key:l,style:{width:"86vw",padding:"16px 0","margin-left":"7vw","margin-top":"15px"},onClick:e=>{return a=l,ne(),Q.value.push(W.value[a]),W.value=[],void(ue.value="");var a}},{default:n((()=>[o(a,{style:{"margin-left":"16px"}},{default:n((()=>[o(a,{class:"name"},{default:n((()=>[m(f(e.name),1)])),_:2},1024),o(a,{class:"msg"},{default:n((()=>[m("学号："+f(e.num),1)])),_:2},1024),o(a,{class:"msg"},{default:n((()=>[m("专业："+f(e.pros),1)])),_:2},1024),o(a,{class:"msg"},{default:n((()=>[m("班级："+f(e.ban),1)])),_:2},1024),o(a,{class:"msg"},{default:n((()=>[m("电话："+f(e.phone),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},512)):i("",!0)],64)}}},[["__scopeId","data-v-cfd11681"]]);export{R as default};
